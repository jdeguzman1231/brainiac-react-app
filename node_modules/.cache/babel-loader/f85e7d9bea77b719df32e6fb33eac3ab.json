{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.plugin = void 0;\n\nconst graphql_1 = require(\"graphql\");\n\nconst {\n  name: PACKAGE_NAME\n} = require(\"../package.json\");\n\nexports.plugin = (_futureOptions = {}) => () => ({\n  requestDidStart() {\n    const startWallTime = new Date();\n    let endWallTime;\n    const startHrTime = process.hrtime();\n    let duration;\n    const resolverCalls = [];\n    return {\n      executionDidStart: () => ({\n        executionDidEnd: () => {\n          duration = process.hrtime(startHrTime);\n          endWallTime = new Date();\n        },\n\n        willResolveField({\n          info\n        }) {\n          const resolverCall = {\n            path: info.path,\n            fieldName: info.fieldName,\n            parentType: info.parentType,\n            returnType: info.returnType,\n            startOffset: process.hrtime(startHrTime)\n          };\n          resolverCalls.push(resolverCall);\n          return () => {\n            resolverCall.endOffset = process.hrtime(startHrTime);\n          };\n        }\n\n      }),\n\n      willSendResponse({\n        response\n      }) {\n        if (typeof endWallTime === 'undefined' || typeof duration === 'undefined') {\n          return;\n        }\n\n        const extensions = response.extensions || (response.extensions = Object.create(null));\n\n        if (typeof extensions.tracing !== 'undefined') {\n          throw new Error(PACKAGE_NAME + \": Could not add `tracing` to \" + \"`extensions` since `tracing` was unexpectedly already present.\");\n        }\n\n        extensions.tracing = {\n          version: 1,\n          startTime: startWallTime.toISOString(),\n          endTime: endWallTime.toISOString(),\n          duration: durationHrTimeToNanos(duration),\n          execution: {\n            resolvers: resolverCalls.map(resolverCall => {\n              const startOffset = durationHrTimeToNanos(resolverCall.startOffset);\n              const duration = resolverCall.endOffset ? durationHrTimeToNanos(resolverCall.endOffset) - startOffset : 0;\n              return {\n                path: [...graphql_1.responsePathAsArray(resolverCall.path)],\n                parentType: resolverCall.parentType.toString(),\n                fieldName: resolverCall.fieldName,\n                returnType: resolverCall.returnType.toString(),\n                startOffset,\n                duration\n              };\n            })\n          }\n        };\n      }\n\n    };\n  }\n\n});\n\nfunction durationHrTimeToNanos(hrtime) {\n  return hrtime[0] * 1e9 + hrtime[1];\n}","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.plugin = void 0;\nconst graphql_1 = require(\"graphql\");\nconst { name: PACKAGE_NAME } = require(\"../package.json\");\nexports.plugin = (_futureOptions = {}) => () => ({\n    requestDidStart() {\n        const startWallTime = new Date();\n        let endWallTime;\n        const startHrTime = process.hrtime();\n        let duration;\n        const resolverCalls = [];\n        return {\n            executionDidStart: () => ({\n                executionDidEnd: () => {\n                    duration = process.hrtime(startHrTime);\n                    endWallTime = new Date();\n                },\n                willResolveField({ info }) {\n                    const resolverCall = {\n                        path: info.path,\n                        fieldName: info.fieldName,\n                        parentType: info.parentType,\n                        returnType: info.returnType,\n                        startOffset: process.hrtime(startHrTime),\n                    };\n                    resolverCalls.push(resolverCall);\n                    return () => {\n                        resolverCall.endOffset = process.hrtime(startHrTime);\n                    };\n                },\n            }),\n            willSendResponse({ response }) {\n                if (typeof endWallTime === 'undefined' ||\n                    typeof duration === 'undefined') {\n                    return;\n                }\n                const extensions = response.extensions || (response.extensions = Object.create(null));\n                if (typeof extensions.tracing !== 'undefined') {\n                    throw new Error(PACKAGE_NAME + \": Could not add `tracing` to \" +\n                        \"`extensions` since `tracing` was unexpectedly already present.\");\n                }\n                extensions.tracing = {\n                    version: 1,\n                    startTime: startWallTime.toISOString(),\n                    endTime: endWallTime.toISOString(),\n                    duration: durationHrTimeToNanos(duration),\n                    execution: {\n                        resolvers: resolverCalls.map(resolverCall => {\n                            const startOffset = durationHrTimeToNanos(resolverCall.startOffset);\n                            const duration = resolverCall.endOffset\n                                ? durationHrTimeToNanos(resolverCall.endOffset) - startOffset\n                                : 0;\n                            return {\n                                path: [...graphql_1.responsePathAsArray(resolverCall.path)],\n                                parentType: resolverCall.parentType.toString(),\n                                fieldName: resolverCall.fieldName,\n                                returnType: resolverCall.returnType.toString(),\n                                startOffset,\n                                duration,\n                            };\n                        }),\n                    },\n                };\n            },\n        };\n    },\n});\nfunction durationHrTimeToNanos(hrtime) {\n    return hrtime[0] * 1e9 + hrtime[1];\n}\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}